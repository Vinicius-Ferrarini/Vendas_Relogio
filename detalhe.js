function renderizarDetalhes(e){const a=document.getElementById("detalheProdutoContainer");if(!e)return void(a.innerHTML="<p>Produto não encontrado.</p>");const t=e.images&&e.images.length?e.images:["https://via.placeholder.com/800x800?text=Sem+Imagem"],n=t[0],r=t.slice(0,4).map(e=>`<img src="${escapeHtml(e)}" alt="Miniatura" class="card-thumb" loading="lazy">`).join(""),o=formatPrice(e.preco||0),d=e.precoOriginal&&e.precoOriginal!==e.preco?`<span class="preco-original">${formatPrice(e.precoOriginal)}</span>`:"",i=e.descricao?escapeHtml(e.descricao).replace(/\n/g,"<br>"):"Nenhuma descrição disponível.",c=getCart(),s=c.find(a=>a.id.toString()===e.id.toString()&&!a.observacao),l=s?"✅ Já no carrinho":"Adicionar ao Carrinho";a.innerHTML=`\n        <img src="${escapeHtml(n)}" alt="${escapeHtml(e.nome)}" id="detalhe-img-main">\n        <div class="card-img-thumbs">${r}</div>\n        <h1 class="detalhe-nome">${escapeHtml(e.nome)}</h1>\n        <div class="detalhe-preco">\n            ${d}\n            <span class="preco-atual">${o}</span>\n        </div>\n        \n        <div class="detalhe-observacao" style="margin-top:15px; margin-bottom:10px; display:flex; flex-direction:column;">\n            <label for="detalheObs" style="margin-bottom:5px; font-weight:600;">Observação (Opcional):</label>\n            <textarea id="detalheObs" placeholder="Ex: Ajuste de pulseira, embalar para presente..." style="width:100%; min-height:60px; padding:8px; border:1px solid #ccc; border-radius:4px; box-sizing:border-box;"></textarea>\n        </div>\n\n        <button class="btn-add-cart detalhe-btn-whats" id="detalheAddCart">${l}</button>\n        \n        <p class="detalhe-descricao">${i}</p>\n    `,s&&(document.getElementById("detalheAddCart").disabled=!0),adicionarClickHandlerMiniaturasDetalhe(a)}function adicionarClickHandlerMiniaturasDetalhe(e){e.addEventListener("click",e=>{if(e.target.classList.contains("card-thumb")){e.preventDefault();const a=document.getElementById("detalhe-img-main");a&&(a.src=e.target.src)}})}document.addEventListener("DOMContentLoaded",()=>{let e;initCheckout();try{const a=new URLSearchParams(window.location.search).get("data");if(!a)throw new Error("Nenhum dado de produto encontrado na URL.");e=JSON.parse(decodeURIComponent(a)),e.id=e.id.toString(),renderizarDetalhes(e),document.title=`${e.nome||"Detalhes"} - Eleven Store`;const t=document.getElementById("detalheAddCart");t&&t.addEventListener("click",()=>{let a=getCart();const t=document.getElementById("detalheObs"),n=t?t.value.trim():"",r=a.findIndex(a=>a.id===e.id&&(a.observacao||"")===n);r>-1?a[r].quantity++:a.push({id:e.id,nome:e.nome,preco:e.preco,quantity:1,observacao:n}),saveCart(a),updateCartButtonText(),abrirModalCarrinho()})}catch(e){console.error("Erro ao carregar detalhes do produto:",e),document.getElementById("detalheProdutoContainer").innerHTML=`<p class="erro">Não foi possível carregar os detalhes do produto. Por favor, tente novamente. ${e.message}</p>`}});