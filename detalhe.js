const WHATSAPP_NUMBER="5543999705837";function getCart(){return JSON.parse(localStorage.getItem("leandrinhoCart")||"[]")}function saveCart(e){localStorage.setItem("leandrinhoCart",JSON.stringify(e))}function escapeHtml(e){return e||0===e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}function formatPrice(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e||0)}function renderizarDetalhes(e){const t=document.getElementById("detalheProdutoContainer");if(!e)return void(t.innerHTML="<p>Produto não encontrado.</p>");const a=e.images&&e.images.length?e.images:["https://via.placeholder.com/800x800?text=Sem+Imagem"],n=a[0],o=a.slice(0,4).map((e=>`<img src="${escapeHtml(e)}" alt="Miniatura" class="card-thumb" loading="lazy">`)).join(""),r=formatPrice(e.preco||0),d=e.precoOriginal?`<span class="preco-original">${formatPrice(e.precoOriginal)}</span>`:"",i=e.descricao?escapeHtml(e.descricao):"Nenhuma descrição disponível.",l=getCart().find((t=>t.id.toString()===e.id.toString()&&!t.observacao)),c=l?"✅ Já no carrinho":"Adicionar ao Carrinho";t.innerHTML=`<img src="${escapeHtml(n)}" alt="${escapeHtml(e.nome)}" id="detalhe-img-main"><div class="card-img-thumbs">${o}</div><h1 class="detalhe-nome">${escapeHtml(e.nome)}</h1><div class="detalhe-preco">${d}<span class="preco-atual">${r}</span></div><button class="btn-add-cart detalhe-btn-whats" id="detalheAddCart">${c}</button><div class="detalhe-observacao" style="margin-top:15px;margin-bottom:10px;display:flex;flex-direction:column;"><label for="detalheObs" style="margin-bottom:5px;font-weight:600;">Observação:</label><textarea id="detalheObs" placeholder="Ex: Ajuste de pulseira, embalar para presente..." style="width:100%;min-height:60px;padding:8px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;"></textarea></div><div class="detalhe-pedido-rapido"><label for="detalheQuantidade">Quantidade:</label><input type="number" id="detalheQuantidade" value="1" min="1"><button id="enviarPedidoDetalhe">Pedir Agora via WhatsApp</button></div><p class="detalhe-descricao">${i}</p>`,adicionarClickHandlerMiniaturasDetalhe(t)}function adicionarClickHandlerMiniaturasDetalhe(e){e.addEventListener("click",(e=>{if(e.target.classList.contains("card-thumb")){e.preventDefault();const t=document.getElementById("detalhe-img-main");t&&(t.src=e.target.src)}}))}function handlePedidoRapido(e){const t=document.getElementById("detalheQuantidade"),a=parseInt(t.value,10);if(isNaN(a)||a<1)return alert("Por favor, insira uma quantidade válida (1 ou mais)."),void(t.value=1);const n=document.getElementById("detalheObs"),o=n?n.value.trim():"",r=o?`\n\nObservação: ${o}`:"",d=formatPrice(e.preco*a),i=`Olá! Gostaria de pedir o seguinte item:\n\n${a}x ${e.nome} - ${d}${r}\n\n(Pedido Rápido)`,l=`https://wa.me/5543999705837?text=${encodeURIComponent(i)}`;window.open(l,"_blank")}document.addEventListener("DOMContentLoaded",(()=>{let e;try{const t=new URLSearchParams(window.location.search).get("data");if(!t)throw new Error("Nenhum dado de produto encontrado na URL.");e=JSON.parse(decodeURIComponent(t)),e.id=e.id.toString(),renderizarDetalhes(e),document.title=`${e.nome||"Detalhes"} - Leandrinho Relógios`;const a=document.getElementById("detalheAddCart");a&&a.addEventListener("click",(()=>{let t=getCart();const n=document.getElementById("detalheObs"),o=n?n.value.trim():"",r=t.findIndex((t=>t.id===e.id&&(t.observacao||"")===o));r>-1?t[r].quantity++:t.push({id:e.id,nome:e.nome,preco:e.preco,quantity:1,observacao:o}),saveCart(t),a.textContent="✅ Adicionado!",a.disabled=!0,o&&alert("Item adicionado com observação!")}));const n=document.getElementById("enviarPedidoDetalhe");n&&n.addEventListener("click",(()=>handlePedidoRapido(e)))}catch(e){console.error("Erro ao carregar detalhes do produto:",e);document.getElementById("detalheProdutoContainer").innerHTML=`<p class="erro">Não foi possível carregar os detalhes do produto. Por favor, tente novamente. ${e.message}</p>`}}));